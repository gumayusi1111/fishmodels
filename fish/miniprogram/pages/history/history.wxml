<view class="container">
  <view class="header">
    <text class="title">å†å²è®°å½•</text>
  </view>

  <!-- æˆæƒæç¤º -->
  <view wx:if="{{needAuth}}" class="auth-prompt">
    <view class="auth-icon">ğŸ”</view>
    <text class="auth-title">éœ€è¦æˆæƒ</text>
    <text class="auth-desc">æŸ¥çœ‹å†å²è®°å½•éœ€è¦å…ˆæˆæƒè·å–ç”¨æˆ·ä¿¡æ¯</text>
    <button class="auth-btn" bindtap="getUserProfile">ç«‹å³æˆæƒ</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:elif="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view wx:elif="{{historyList.length > 0}}" class="history-list">
    
    <view wx:for="{{historyList}}" wx:key="_id" class="history-item-wrapper">
      <!-- ä½¿ç”¨movable-areaå’Œmovable-viewå®ç°æ»‘åŠ¨åˆ é™¤ -->
      <movable-area class="movable-area">
        <movable-view 
          class="movable-item" 
          direction="horizontal" 
          x="{{item.x || 0}}"
          damping="50"
          friction="5"
          bindchange="onItemMove"
          bindtouchend="onItemTouchEnd"
          data-index="{{index}}">
          
          <view class="history-item" bindtap="viewDetail" data-index="{{index}}">
            <!-- åª’ä½“é¢„è§ˆ -->
            <view class="media-preview">
              <image wx:if="{{item.mediaType === 'image'}}" class="preview-thumb" src="{{item.mediaUrl}}" mode="aspectFill"></image>
              <video wx:if="{{item.mediaType === 'video'}}" class="preview-thumb" src="{{item.mediaUrl}}" poster="{{item.mediaUrl}}"></video>
            </view>
            
            <!-- åˆ†æç»“æœæ‘˜è¦ -->
            <view class="result-summary">
              <!-- ä¿®å¤æ•°æ®ç»‘å®šè·¯å¾„ -->
              <view class="species">{{item.result.species.name || item.result.species || 'æœªçŸ¥å“ç§'}}</view>
              <view class="confidence">ç½®ä¿¡åº¦: {{item.result.species.confidence || item.result.confidence || 0}}%</view>
              <view class="time">{{item.createTime}}</view>
            </view>
            
            <!-- ç®­å¤´å›¾æ ‡ -->
            <view class="arrow">></view>
          </view>
          
          <!-- åˆ é™¤æŒ‰é’® -->
          <view class="delete-btn" bindtap="confirmDelete" data-index="{{index}}">
            <text>åˆ é™¤</text>
          </view>
        </movable-view>
      </movable-area>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ“</view>
    <text class="empty-title">æš‚æ— å†å²è®°å½•</text>
    <text class="empty-desc">å¼€å§‹åˆ†æé±¼ç±»å›¾ç‰‡æˆ–è§†é¢‘ï¼Œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
  </view>

  <button class="back-btn" bindtap="goBack">è¿”å›æ£€æµ‹</button>
</view>