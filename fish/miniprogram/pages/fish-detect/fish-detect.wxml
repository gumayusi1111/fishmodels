<view class="container">
  <!-- é¡µé¢æ ‡é¢˜å’Œå†å²æŒ‰é’® -->
  <view class="page-header">
    <view class="title">æ™ºèƒ½é±¼ç±»è¯Šæ–­</view>
    <button class="history-btn" bindtap="viewHistory">
      <text class="history-icon">ğŸ“‹</text>
      <text class="history-text">å†å²</text>
    </button>
  </view>

  <!-- åª’ä½“é€‰æ‹©ç»„ä»¶ -->
  <media-selector 
    media-type="{{mediaType}}"
    bind:mediaTypeChange="onMediaTypeChange"
    bind:mediaSelected="onMediaSelected">
  </media-selector>

  <!-- åª’ä½“é¢„è§ˆ -->
  <view wx:if="{{mediaUrl}}" class="media-preview">
    <!-- æ·»åŠ è°ƒè¯•ä¿¡æ¯ -->
    <view class="debug-info" style="background: #f0f0f0; padding: 10rpx; margin-bottom: 20rpx; font-size: 24rpx;">
      <text>è°ƒè¯•ä¿¡æ¯:</text>
      <text>\nmediaUrl: {{mediaUrl}}</text>
      <text>\nmediaType: {{mediaType}}</text>
      <text>\nmediaUrlé•¿åº¦: {{mediaUrl.length}}</text>
    </view>
    
    <image 
      wx:if="{{mediaType === 'image'}}" 
      class="preview-image" 
      src="{{mediaUrl}}" 
      mode="aspectFit"
      binderror="onImageError"
      bindload="onImageLoad">
    </image>
    <video wx:if="{{mediaType === 'video'}}" class="preview-video" src="{{mediaUrl}}" controls></video>
    
    <view class="media-info">
      <text class="media-size">{{mediaSize}}</text>
    </view>
  </view>

  <!-- è§†é¢‘åˆ†æç»„ä»¶ -->
  <video-analyzer 
    wx:if="{{mediaType === 'video' && mediaUrl}}"
    video-url="{{mediaUrl}}"
    bind:framesExtracted="onFramesExtracted">
  </video-analyzer>

  <!-- åˆ†ææŒ‰é’® -->
  <view wx:if="{{mediaUrl}}" class="action-section">
    <button class="action-btn analyze" bindtap="startAnalysis" disabled="{{isAnalyzing}}">
      {{isAnalyzing ? 'åˆ†æä¸­...' : 'å¼€å§‹åˆ†æ'}}
    </button>
  </view>

  <!-- åˆ†æè¿›åº¦ç»„ä»¶ -->
  <analysis-progress 
    wx:if="{{isAnalyzing}}"
    is-analyzing="{{isAnalyzing}}"
    media-type="{{mediaType}}"
    progress="{{analysisProgress}}">
  </analysis-progress>

  <!-- åˆ†æç»“æœç»„ä»¶ -->
  <view wx:if="{{showResult && result}}" class="result-container">
    <text class="debug-text">showResult: {{showResult}}, resultå­˜åœ¨: {{!!result}}</text>
    
    <analysis-result 
      result="{{result}}"
      media-type="{{mediaType}}"
      show-result="{{showResult}}"
      bind:saveResult="saveToHistory"
      bind:shareResult="onShareResult"
      bind:viewHistory="onViewHistory"
      bind:reselect="onReselect">
    </analysis-result>
  </view>
</view>